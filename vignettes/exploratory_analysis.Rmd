---
title: "Vignette Title"
author: "Vignette Author"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
```{r, }

data("BoardGames")

BoardGames <- bgg.prepare.data(BoardGames)

# summarize by year
boardgames.by.years <- BoardGames %>%
  mutate(details.yearpublished=as.numeric(details.yearpublished)) %>%
  filter(!is.na(details.yearpublished)) %>%
  group_by(details.yearpublished) %>%
  summarise(count = n())

# we got a 7700 missing and 1q=1994, Median=2006
ggplot(boardgames.by.years,aes(details.yearpublished,count)) +
  geom_line() +
  ggtitle(paste('Board Games released by Year, ', min(boardgames.by.years$details.yearpublished),'-', max(boardgames.by.years$details.yearpublished))) +
  xlab('year') +
  ylim(c(0,max(boardgames.by.years$count)))

# Stimiamo la % di missing degli attributi
col.nulls <- colMeans(is.na(BoardGames))
col.nulls.percent <- percent(colMeans(is.na(BoardGames)))
names(col.nulls.percent) <- names(col.nulls)

which(col.nulls)


# Cumulative Freq-plot of year (median in red -> 2006)
ggplot(BoardGames, aes(as.numeric(details.yearpublished))) + 
  stat_ecdf() +
  ggtitle("Cumulative freq-plot of Release Year") +
  geom_hline(yintercept=ecdf(BoardGames$details.yearpublished)(2006), color = 'red') +
  geom_vline(xintercept=2006, color = 'red')

# Cumulative Freq-plot of user ratings. (80% has less than 25 ratings)
# We really don't wont the otuliers to pollute the plot
quantile(BoardGames$stats.usersrated, seq(0, 1, 0.05), na.rm = TRUE)

ggplot(BoardGames, aes(stats.usersrated)) +
  stat_ecdf() +
  ggtitle("Cumulative freq-plot of User Ratings") +
  xlim(c(0, quantile(BoardGames$stats.usersrated, seq(0, 1, 0.05), na.rm = TRUE)['95%']))

# ---------> filter out games where ratings < 25

bgg.useful <- BoardGames %>% filter(stats.usersrated >= 25)

# Cumulative Freq-plot of average rating
quantile(bgg.useful$stats.average, seq(0, 1, 0.05), na.rm = TRUE)

# Ratings are gaussian!
ggplot(bgg.useful, aes(stats.average)) +
  geom_histogram(binwidth = .1, fill="deeppink")

ggplot(bgg.useful, aes(stats.average)) +
  stat_ecdf() +
  ggtitle("Cumulative freq-plot of Average Ratings") +
  #xlim(c(0, quantile(BoardGames$stats.usersrated, seq(0, 1, 0.05), na.rm = TRUE)['95%']))

# Cumulative Freq-plot of minimum age
quantile(bgg.useful$details.minage, seq(0, 1, 0.05), na.rm = TRUE)

# 
ggplot((bgg.useful %>% filter(details.minage < 25)), aes(details.minage)) +
  geom_histogram(binwidth = 1, fill="deeppink")

ggplot((bgg.useful %>% filter(details.minage < 25)), aes(details.minage)) +
  stat_ecdf() +
  ggtitle("Cumulative freq-plot of Average Ratings") +
  #xlim(c(0, quantile(BoardGames$stats.usersrated, seq(0, 1, 0.05), na.rm = TRUE)['95%']))






```
